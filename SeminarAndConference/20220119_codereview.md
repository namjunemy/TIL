## Okky 코드리뷰 세미나

- 2022/01/19
- 연사 : 백명석님
- 작성자 : 권용근(kingbbode)님
  - https://kingbbode.notion.site/okky-934826d538fb4af1b8be2775b233814d
- 공유 받은 내용

## 왜 코드리뷰를 해야 하나?

### 우리가 살고 있는 세계

- Software is eating the world (Marc Andreessen, 2011, WSJ)
- 2016 4차산업
  - 불확실하고, 복잡하고, 모호하며, 변화가 많은 세상이 될 것 (VUCA)
- Build 2021 (Satya Nadella, MS CEO)
  - GDP  에서 Tech 의 비율(2020:5% → 2030:10%)
    - 주목할 것은 나머지 90%. DT 는 이제 시작
  - 지난 2년 동안 Non-Tech 영역에서 개발자 수 증가속도가 Tech 영역에서보다 가파름

### 개발 생산성

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f4c06fb2-d6e1-4027-beb1-ae3cefce20a8/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3d9a8c74-2895-4672-a66d-7ec70cc34de8/Untitled.png)

### SW 공학의 특성

공학 = 설계(Design) + 빌드(Build)

- 설계 : 예측하기 어렵고, 급여가 비싸고 창의적인 사람들을 필요
- 빌드 : 좀 더 예측하기 쉬움
- 건축공학
  - 설계와 빌드가 분리
  - 빌드 비용이 비쌈(건축 90%)
  - 유지보수 비용이 상대적으로 낮음
- 공학 활동의 최종 목적
  - 빌드 할 수 있는 어떤 종류의 재생산 가능한 문서
- SW 공학의 설계와 빌드
  - 설계 = 완전한 소스 코드
  - SW 빌드 = 컴파일
- **좋은 설계 ~= 클린코드**
- SW 엔지니어: 설계를 잘하는 사람 → 코드를 잘 작성하는 사람
- 클린 코드의 중요성
  - SW의 진정한 비용 ~= 유지보수 (전체의 80% 이상)
  - 한번 작성한 코드는 10ㅓㄴ 이상 읽음/ 작성 보다 이해에 10배의 노력 소요
  - 90% 이상의 시간을 어떤 코드를 이해하는데 사용함
- SW 개발의 단순한 진리
  - The Only way to go fast, is to go well - Robert C.Martin
  - 시간이 흘러도 생산성 저하. 비용 증가를 막을 수 있는 유일하 방법
  - SW 품질에 신중해야
    - SW의 비용과 품질의 관계는 비정상적, 비직관적
    - 향후 변경 비경을 낮춤으로써 익숙한 트레이드오프를 역전시킴
- SW 장인정신
  - 지식과 경험의 공유 만이 전문성을 갖춘 개발자 육성
  - 후배들에게 지식과 경험을 공유

### 목적

- 주목적: 품질 문제 검수
- 더 나은 코드 품질: 아키텍처 속성 개선을 위한 코드 개선(향후 변경 비용 개선)
- 학습 및 지식 전달: 코드, 해결책 등과 관련된 지식 공유에 기여
  - 공유(주고 받는 학습)를 통한 역량 증대 및 성장
  - 참여한 모든 사람들의 배움의 기회
  - 대개의 경우 리뷰어들도 리뷰 과정에서 지식을 얻게 됨(하드스킬, 소프트스킬)
  - 동기부여
- 상호 책임감 증대
  - 집단 코드 오너십 및 결속 증대
  - 내가 하고 있는 일에 관심을 가져주는 것
  - 팀에서 일어나는 일 공유. 내 동료는 무엇을 하나? 팀웍
- 개발 문화 개선
- 설계 개선 제안

## 왜 코드 리뷰가 어려운가?

- 코드에 대한 비판을 자신에 대한 비판으로 이해
  - 저자: 본인 생각에 멋지다고 생각하는 PR을 보냄
  - 리뷰어: 왜 멋지지 않은지에 대한 장황한 이유를 작성
  - 코드 리뷰는 잘한 것도 공유, 아쉬운 것도 공유
    - 지식/공항겆 결정을 공유
    - 공유를 통해 지식/경험을 나누며 상호 학습을 통한 역량 증대 수단
    - 코드 토의를 개인적 공격으로 받아들이면 물거품
- 생각을 글로 전달하는 것에 대한 어려움
  - 오해의 위험이 큼 (음성, 표정의 부재)
  - 피드백을 조심스럽게 표현하는 것이 더 중요

## 효율적인 PR 방법

- 지루한 작업은 컴퓨터로 처리

  코드를 읽는 것은 인지적 부담이 되는 고수준의 집중이 요구

  - Formatting 은 별도의 커밋/PR로 분리
  - 리뷰 불필요를 기술

- 스타일 가이드를 통해 스타일 논쟁을 해소

  - 스타일에 대한 논쟁은 리뷰에서 시간 낭비

- PR을 올릴 때 주석 달기

  - PR을 저자가 먼저 읽어보고 리뷰어들을 위한 설명 커맨드 작성

- 모두를 포함하라

  - 많은 사람들이 볼 수록 버그를 더 잘 찾아낼 수 있다
  - 많은 사람이 볼 때 더 잘하려는 경향이 있음

- 의미있는 커밋으로 분리

  - 혼자하더라도 의미가 있음
  - 기록을 통해 내가 무엇을 했는지 알 수 있음

- 코드 리뷰를 높은 우선순위로

  - 저자는 리뷰 종료까지 대기

- 리뷰는 바로 시작하면 선순환됨

- 리뷰 라운드의 최대 시간은 하루

- 더 자주해라

- PR에 포함된 변경이 적도록 노력

- 리뷰할 시간이 없다고 느낌

  - 조직의 평가 문제

- Pull Requests vs Pair Programming

  - 트레이드오프: Latency or Throughput

- 고수준으로 시작, 저수준으로 내려가라

  - 리뷰 라운드에서 만은 의견을 남길 수록, 저자가 당황할 위험 커짐
  - 초기 라운드에서는 고수준 피드백으로 제한
    - 버그, 장애, 성능, 보안
  - 고수준의 피드백이 처리된 후에 저수준 이슈를 처리
    - 변수명

- 예제 코드 제공에 관대하라

  - 저자를 기분 좋게 하기 위한 방법
  - 너무 긴 예제는 관대한 것이 아니라 억압적으로 보임

- 리뷰의 범위를 존중하라

  - 자주 보이는 anti-pattern
  - Rule of thumb
    - PR에 포함되지 않은 라인은 리뷰 범위가 아님
  - ex) 바로 윗 라인에 오타가 보여도 리뷰하지 않음
  - 예외 : PR이 둘러싼 코드에 영향을 미칠 때

- 태그를 활용

  - Nit : 고치면 좋지만 아니어도 그만
  - LGTM
  - 리뷰어는 항상 더 개선할 수 있는 의견을 자유롭게 남길 수 있어야 함

- 한두 등급만 코드 레벨을 올리는 것을 목표로

  - D 등급의 PR 을 받으면 저자가 C 나 B 등급을 받도록 도와라
    - Latter Grade
  - 완전하지는 않아도 충분히 좋은 코드가 되도록
  - 승인을 보류하는 유일한 이유는 수 차례의 리뷰 라운드 후에도 코드가 F 상태인 경우

## 피드백 방법

- 절대 “너”라고 하지마라

  - 무엇이 코드를 나아지게 하는가
  - 비판의 대상은 코드
  - ~ 하는 것을 제안합니다. ~ 하는게 어떨까요? (오픈커뮤니케이션)

- 건설적인 피드백

  - 동료들 간의 코드 리뷰은 경쟁 유발 X, 생산성 높이는 것
  - 비판이 아니라 학습의 과정으로 인지
  - 개발자들이 그들의 실수에서 배우고 역량을 증대시킴

- 진정한 칭찬

  - 대부분 리뷰어가 잘못된 부분에만 집중
  - 진심어린 칭찬은 리뷰어가 잔인한 감시자가 아니라 도와주려는 팀동료라는 것을 보여서 이런 긴장감을 낮춤

- 명령이 아니라 요청으로 표현

  - 일상에서 동료에게 명령하지 않음
  - 하지만 리뷰에서는 강압적인 명령이 종종 발견됨
    - 별도의 파일로 분리하라 → 별도의 파일로 분리할 수 있을까요?

- 의견이 아니라 원칙에 기반하여 피드백

  - 저자에게 의견을 줄 때는 “제안하는 변경”과 “변경의 이유”를 모두 설명하라
  - SW는 과학인 동시에 예술
    - 항상 원칙에 기반하여 정확히 뭐가 잘못되었는지 언급할 수 있는 것은 아님
    - 단지 그냥 보기 싫거나 직관적이지 않을 수 있음

- 반복적인 패턴에 대해서 피드백을 제한하라

  - 저자의 실수가 동일한 패턴임을 식별했다면 모든 경우를 언급하지는 말라
  - 동일 패턴에 대해서 2~3개 정도의 예를 언급

- 교착상태를 적극적으로 처리해라

  - 표식
    - 톤이 점차 팽팽해지고 공격적으로 됨
    - 라운드당 커멘트가 줄어들지 않은 경향
    - 너무 많은 커멘트에 저항이 보임
  - 만나서 얘기해라
  - 인정하거나 escalate하라
    - 교착상태가 길어지면 관계가 나빠짐
    - 그냥 승인하는 비용 (agree to disagree)
    - 저수준 코드를 무심코 승인하면 SW 품질이 낮아질 수 있지만, 동료와 너무 다퉈서 함께 일하지 않게 된다면 고수준의 품질을 얻을 수 없음
  - 인정이 불가한 경우
    - 다른 리뷰어에게 할당
  - 설계 리뷰를 고려하라

  ### 코드 리뷰를 하는 아주 재밌는 방법

  - 짝 프로그래밍으로 어떻게 고치는게 좋은지 보여주고 Revert하고 스스로 해보게 해라
  - 결정은 저자가
    - 완벽한 설계가 아니라 당신이 할 수 있는 최고의 설계를 추구
    - 팀 정신을 유지하기 위해 불완전한 해결책을 받아들여라
    - 모든 설계 결함이 항상 실제로 문제가 되지는 않음
  - 코드 리뷰의 목적은 비난이 아니라 배움이다